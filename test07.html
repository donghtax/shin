<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Donghyun Tax Accounting Office</title>
    <style>
        /* CSS ìŠ¤íƒ€ì¼ì€ ê·¸ëŒ€ë¡œ ìœ ì§€ */
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="company-name">Donghyun Tax Accounting Office</div>
            <div class="current-time" id="current-time"></div>
        </div>
        <div class="content-wrapper">
            <div class="calendar-section">
                <iframe class="calendar-iframe" src="https://calendar.google.com/calendar/embed?src=bbory.cpa%40gmail.com&src=eunjuuu2%40gmail.com&src=yungjin97%40gmail.com&src=seungju317%40gmail.com&src=actor001%40naver.com&src=8a4b3ad9ffdb68663b95a1a263441e4a5f3fe06775cdd31c729191a93cf18f58%40group.calendar.google.com&src=ko.south_korea%23holiday%40group.v.calendar.google.com&color=%23B1365F&color=%232F6309&ctz=Asia%2FSeoul&mode=MONTH&showTitle=0&timeFormat=24hour"></iframe>
            </div>
            <div class="bottom-section">
                <div class="schedule-section">
                    <div class="yesterday-schedule">
                        <h2 class="section-title">ğŸ“… Yesterday's Schedule</h2>
                        <div id="yesterday-events"></div>
                    </div>
                    <div class="today-schedule">
                        <h2 class="section-title">ğŸ“… Today's Schedule</h2>
                        <div id="today-events"></div>
                    </div>
                    <div class="tomorrow-schedule">
                        <h2 class="section-title">ğŸ“… Tomorrow's Schedule</h2>
                        <div id="tomorrow-events"></div>
                    </div>
                </div>
                <div class="weather-section">
                    <h2 class="section-title">ğŸŒ¤ï¸ í’ë‚©ë™ ë‚ ì”¨</h2>
                    <div id="weather-container"></div>
                </div>
                <div class="news-container">
                    <h2 class="section-title">ğŸ“° Tax-related News</h2>
                    <div id="news-container"></div>
                </div>
            </div>
        </div>
    </div>
    <script>
        const CALENDAR_API_KEY = "AIzaSyBk3K41Abu-u2xn8591ERFUa2tc36gUXw0";
        const WEATHER_API_KEY = "Dq2Ai7o+QAfIM1yNmRzrlhnMTJlmQb7Jkh65M0IzIrDAtZ3P0DMtKc0UVQPgtMvSTKB74CbzERLfxBBN0mwffw==";

        function updateTime() {
            const now = new Date();
            const options = { 
                year: 'numeric', month: '2-digit', day: '2-digit', 
                weekday: 'short', hour: '2-digit', minute: '2-digit', 
                second: '2-digit', hour12: true 
            };
            document.getElementById("current-time").textContent = now.toLocaleString('ko-KR', options);
        }

        async function loadWeather() {
            const weatherContainer = document.getElementById("weather-container");
            try {
                weatherContainer.innerHTML = "<div>ë‚ ì”¨ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>";
                const nx = 62, ny = 126;
                const baseDate = new Date().toISOString().split("T")[0].replace(/-/g, "");
                const weatherUrl = `https://apis.data.go.kr/1360000/VilageFcstInfoService_2.0/getVilageFcst?serviceKey=${encodeURIComponent(WEATHER_API_KEY)}&numOfRows=1000&pageNo=1&base_date=${baseDate}&base_time=0500&nx=${nx}&ny=${ny}&dataType=JSON`;
                const response = await fetch(weatherUrl);
                const data = await response.json();
                if (!data.response?.body?.items) throw new Error("ë‚ ì”¨ ë°ì´í„° í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤");

                const weatherByDay = data.response.body.items.item.reduce((acc, item) => {
                    if (!acc[item.fcstDate]) acc[item.fcstDate] = {};
                    acc[item.fcstDate][item.category] = item.fcstValue;
                    return acc;
                }, {});

                weatherContainer.innerHTML = Object.entries(weatherByDay).slice(0, 5).map(([date, weather]) => {
                    const dateObj = new Date(date.replace(/(\d{4})(\d{2})(\d{2})/, '$1-$2-$3'));
                    return `
                        <div class="weather-item">
                            <div class="weather-date">${dateObj.getMonth() + 1}/${dateObj.getDate()} ${['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '][dateObj.getDay()]}</div>
                            <div class="weather-info">
                                <span>${weather.TMP || "-"}Â°C</span>
                                <span>${getWeatherDescription(weather.SKY, weather.PTY)}</span>
                                <span>${weather.POP || 0}%</span>
                            </div>
                        </div>
                    `;
                }).join('') || "<div>ë‚ ì”¨ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>";
            } catch (error) {
                console.error("ë‚ ì”¨ ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜:", error);
                weatherContainer.innerHTML = "<div class='error-message'>ë‚ ì”¨ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div>";
            }
        }

        function getWeatherDescription(sky, pty) {
            if (!sky || !pty) return "ë°ì´í„° ì—†ìŒ";
            if (pty !== "0") return ["", "ë¹„", "ë¹„/ëˆˆ", "ëˆˆ", "ì†Œë‚˜ê¸°"][pty] || "ê°•ìˆ˜";
            return ["", "ë§‘ìŒ", "", "êµ¬ë¦„ë§ìŒ", "íë¦¼"][sky] || "ì•Œ ìˆ˜ ì—†ìŒ";
        }

        async function loadNews() {
            const newsContainer = document.getElementById("news-container");
            try {
                newsContainer.innerHTML = "<div>ë‰´ìŠ¤ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>";
                const rssUrl = "https://news.google.com/rss/search?q=ì„¸ë¬´&hl=ko&gl=KR&ceid=KR:ko";
                const apiUrl = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(rssUrl)}`;
                const response = await fetch(apiUrl);
                const data = await response.json();
                if (!data.items?.length) throw new Error("ë‰´ìŠ¤ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤");

                newsContainer.innerHTML = data.items.slice(0, 5).map(item => 
                    `<div class="news-item"><a href="${item.link}" target="_blank">${item.title}</a></div>`
                ).join('');
            } catch (error) {
                console.error("ë‰´ìŠ¤ ë¡œë“œ ì¤‘ ì˜¤ë¥˜:", error);
                newsContainer.innerHTML = "<div class='error-message'>ë‰´ìŠ¤ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div>";
            }
        }

        async function loadEvents(containerId, date) {
            const eventsContainer = document.getElementById(containerId);
            try {
                eventsContainer.innerHTML = "<div>ì¼ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>";
                const timeMin = new Date(date.setHours(0, 0, 0, 0)).toISOString();
                const timeMax = new Date(date.setHours(23, 59, 59, 999)).toISOString();
                const calendars = [
                    { id: "bbory.cpa@gmail.com", name: "ëŒ€í‘œ" },
                    { id: "eunjuuu2@gmail.com", name: "ì´ì€ì£¼" },
                    { id: "yungjin97@gmail.com", name: "ê¹€ë³‘íƒœ" },
                    { id: "seungju317@gmail.com", name: "í•˜ìŠ¹ì£¼" },
                    { id: "actor001@naver.com", name: "ê¹€í•´ì§„" },
                    { id: "8a4b3ad9ffdb68663b95a1a263441e4a5f3fe06775cdd31c729191a93cf18f58@group.calendar.google.com", name: "ì„¸ë¬´ì¼ì •" },
                    { id: "ko.south_korea#holiday@group.v.calendar.google.com", name: "ê³µíœ´ì¼" }
                ];

                let eventsHTML = "";
                for (const calendar of calendars) {
                    try {
                        const calendarUrl = `https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(calendar.id)}/events?key=${CALENDAR_API_KEY}&timeMin=${timeMin}&timeMax=${timeMax}&singleEvents=true&orderBy=startTime`;
                        const response = await fetch(calendarUrl);
                        const data = await response.json();
                        if (data.items?.length) {
                            eventsHTML += data.items.map(event => {
                                const eventTime = event.start.dateTime ? new Date(event.start.dateTime).toLocaleTimeString("ko-KR", { hour: "2-digit", minute: "2-digit" }) : "ì¢…ì¼";
                                return `<div class="event-item"><strong>${eventTime}</strong> - ${event.summary} <span style="color: #666; font-size: 0.9em">(${calendar.name})</span></div>`;
                            }).join('');
                        }
                    } catch (error) {
                        console.error(`${calendar.name} ìº˜ë¦°ë” ë¡œë“œ ì¤‘ ì˜¤ë¥˜:`, error);
                    }
                }
                eventsContainer.innerHTML = eventsHTML || "<div>ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</div>";
            } catch (error) {
                console.error("ì¼ì • ë¡œë“œ ì¤‘ ì˜¤ë¥˜:", error);
                eventsContainer.innerHTML = "<div class='error-message'>ì¼ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div>";
            }
        }

        function initializeApp() {
            updateTime();
            loadWeather();
            loadNews();
            [-1, 0, 1].forEach(offset => {
                const date = new Date();
                date.setDate(date.getDate() + offset);
                loadEvents([`yesterday-events`, `today-events`, `tomorrow-events`][offset + 1], date);
            });

            setInterval(updateTime, 1000);
            setInterval(loadWeather, 600000);
            setInterval(loadNews, 600000);
        }

        initializeApp();
    </script>
</body>
</html>
